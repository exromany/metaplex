(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{45963:function(e,n,t){"use strict";t.d(n,{P:function(){return y}});var r=t(92847),i=t.n(r),s=t(76588),a=t(69819),o=t(71800),u=t(83871),c=t(35551),l=t(48834).Buffer;function p(e,n,t,r){return d.apply(this,arguments)}function d(){return(d=(0,s.Z)(i().mark((function e(n,t,r,s){var p,d,f,b,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=(0,a.programIds)(),d=p.store){e.next=4;break}throw new Error("Store not initialized");case 4:f=new c.kv({public:n}),b=l.from((0,u.serialize)(c.Yi,f)),h=[{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:p.token,isSigner:!1,isWritable:!1},{pubkey:p.vault,isSigner:!1,isWritable:!1},{pubkey:p.metadata,isSigner:!1,isWritable:!1},{pubkey:p.auction,isSigner:!1,isWritable:!1},{pubkey:p.system,isSigner:!1,isWritable:!1},{pubkey:o.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}],s.push(new o.TransactionInstruction({keys:h,programId:p.metaplex,data:b}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=t(48834).Buffer;function b(e,n,t,r,i){return h.apply(this,arguments)}function h(){return(h=(0,s.Z)(i().mark((function e(n,t,r,s,l){var p,d,b,h,y,g;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=(0,a.programIds)(),d=p.store){e.next=4;break}throw new Error("Store not initialized");case 4:return e.next=6,(0,c.nO)(n);case 6:b=e.sent,h=new c.Vz({activated:t}),y=f.from((0,u.serialize)(c.Yi,h)),g=[{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p.system,isSigner:!1,isWritable:!1},{pubkey:o.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}],l.push(new o.TransactionInstruction({keys:g,programId:p.metaplex,data:y}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,n,t,r){return g.apply(this,arguments)}function g(){return(g=(0,s.Z)(i().mark((function e(n,t,r,s){var o,u,c,l,d,f,h,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],u=[],c=[],l=[],e.next=6,p(r,t.publicKey,t.publicKey,l);case 6:o.push(c),u.push(l),d=0;case 9:if(!(d<s.length)){e.next=20;break}return f=s[d],h=[],y=[],e.next=15,b(f.address,f.activated,t.publicKey,t.publicKey,y);case 15:o.push(h),u.push(y);case 17:d++,e.next=9;break;case 20:if(1!==u.length){e.next=25;break}return e.next=23,(0,a.sendTransactionWithRetry)(n,t,u[0],o[0],"single");case 23:e.next=27;break;case 25:return e.next=27,(0,a.sendTransactions)(n,t,u,o,a.SequenceType.StopOnFailure,"single");case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},30333:function(e,n,t){"use strict";t.r(n),t.d(n,{AdminView:function(){return B},default:function(){return P}});var r=t(92847),i=t.n(r),s=t(76588),a=t(52322),o=t(77243),u=t(2784),c=t(37488),l=t(13721),p=t(77891),d=t(90385),f=t(24832),b=t(3653),h=t(3086),y=t(3306),g=t(45556),k=t(45719),v=t(35551),m=t(69819),x=t(71800),w=t(45963),j=t(181);function S(e,n,t,r){return C.apply(this,arguments)}function C(){return(C=(0,s.Z)(i().mark((function e(n,t,r,s){var a,o,u,c,l,p,d,f,b,h,y,g,k;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],o=[],u=0,c=0;case 4:if(!(c<t.length)){e.next=50;break}if(p=t[c],!(d=r[(null===(l=p.info.masterEdition)||void 0===l?void 0:l.toBase58())||""])||(null===d||void 0===d?void 0:d.info.key)!=m.MetadataKey.MasterEditionV1){e.next=47;break}if(10!=u){e.next=13;break}return console.log("Waiting 10s before continuing to avoid rate limits"),e.next=12,new Promise((function(e){return setTimeout(e,1e4)}));case 12:u=0;case 13:return console.log("Reviewing",d.pubkey.toBase58()),f=0,e.prev=15,e.next=18,n.getTokenSupply(d.info.printingMint);case 18:b=e.sent,f=b.value.uiAmount||0,e.next=25;break;case 22:e.prev=22,e.t0=e.catch(15),console.error(e.t0);case 25:if((h=s.get(d.info.printingMint.toBase58()))&&(console.log("Existing print account subtracts",h.info.amount.toNumber(),"from",f),f-=h.info.amount.toNumber()),!(f>0)){e.next=32;break}console.log("Reject",d.pubkey.toBase58(),"due to printing bal of",f),o.push(d),e.next=46;break;case 32:return y=0,e.prev=33,e.next=36,n.getTokenSupply(d.info.oneTimePrintingAuthorizationMint);case 36:g=e.sent,y=g.value.uiAmount||0,e.next=43;break;case 40:e.prev=40,e.t1=e.catch(33),console.error(e.t1);case 43:(k=s.get(d.info.oneTimePrintingAuthorizationMint.toBase58()))&&(console.log("Existing one time account subtracts",k.info.amount.toNumber(),"from",y),y-=k.info.amount.toNumber()),y>0?(console.log("Reject",d.pubkey.toBase58(),"due to one time auth bal of",y),o.push(d)):a.push(d);case 46:u++;case 47:c++,e.next=4;break;case 50:return e.abrupt("return",{available:a,unavailable:o});case 51:case"end":return e.stop()}}),e,null,[[15,22],[33,40]])})))).apply(this,arguments)}function Z(e,n,t,r){return O.apply(this,arguments)}function O(){return(O=(0,s.Z)(i().mark((function e(n,t,r,s){var a,o,u,c,l,p,d,f,b,h,y,g,k,v;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(0,m.programIds)(),o=[],u=[],c=[],l=[],p=[],d=[],f=0;case 8:if(!(f<r.length)){e.next=22;break}return b=r[f],console.log("Converting",b.pubkey.toBase58()),h=s.get(b.info.printingMint.toBase58()),y=s.get(b.info.oneTimePrintingAuthorizationMint.toBase58()),h&&(h.info.amount.toNumber()>0&&d.push(j.Token.createBurnInstruction(a.token,b.info.printingMint,h.pubkey,t.publicKey,[],h.info.amount)),d.push(j.Token.createCloseAccountInstruction(a.token,h.pubkey,t.publicKey,t.publicKey,[]))),y&&(y.info.amount.toNumber()>0&&d.push(j.Token.createBurnInstruction(a.token,b.info.oneTimePrintingAuthorizationMint,y.pubkey,t.publicKey,[],y.info.amount)),d.push(j.Token.createCloseAccountInstruction(a.token,y.pubkey,t.publicKey,t.publicKey,[]))),e.next=17,(0,m.convertMasterEditionV1ToV2)(b.pubkey,b.info.oneTimePrintingAuthorizationMint,b.info.printingMint,d);case 17:10===d.length&&(c.push(p),l.push(d),p=[],d=[]),10===l.length&&(o.push(c),u.push(l),c=[],l=[]);case 19:f++,e.next=8;break;case 22:d.length<10&&d.length>0&&(c.push(p),l.push(d)),l.length<=10&&l.length>0&&(o.push(c),u.push(l)),console.log("Instructions",u),g=0;case 26:if(!(g<u.length)){e.next=41;break}if(k=u[g],v=o[g],console.log("Running batch",g),!(k.length>=2)){e.next=35;break}return e.next=33,(0,m.sendTransactions)(n,t,k,v,m.SequenceType.StopOnFailure,"single");case 33:e.next=37;break;case 35:return e.next=37,(0,m.sendTransactionWithRetry)(n,t,k[0],v[0],"single");case 37:console.log("Done");case 38:g++,e.next=26;break;case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function W(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?T(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var A=c.Z.Content,B=function(){var e=(0,k.jq)(),n=e.store,t=e.whitelistedCreatorsByCreator,r=(0,m.useConnection)(),i=(0,m.useWallet)(),s=i.wallet,o=i.connected;return n&&r&&s&&o?(0,a.jsx)(M,{store:n,whitelistedCreatorsByCreator:t,connection:r,wallet:s,connected:o}):(0,a.jsx)(l.Z,{})},P=B;function E(e){var n=e.setUpdatedCreators,t=e.uniqueCreatorsWithUpdates,r=(0,u.useState)(!1),i=r[0],s=r[1],c=(0,u.useState)(""),l=c[0],b=c[1];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{title:"Add New Artist Address",visible:i,onOk:function(){var e,r=l;if(b(""),s(!1),t[r])(0,m.notify)({message:"Artist already added!",type:"error"});else try{e=new x.PublicKey(r),n((function(n){return W(W({},n),{},(0,o.Z)({},l,new v.JP({address:e,activated:!0})))}))}catch(i){(0,m.notify)({message:"Only valid Solana addresses are supported",type:"error"})}},onCancel:function(){b(""),s(!1)},children:(0,a.jsx)(d.Z,{value:l,onChange:function(e){return b(e.target.value)}})}),(0,a.jsx)(f.Z,{onClick:function(){return s(!0)},children:"Add Creator"})]})}function M(e){var n=e.store,t=e.whitelistedCreatorsByCreator,r=e.connection,c=e.wallet,p=e.connected,d=(0,u.useState)(n&&n.info&&new v.yh(n.info)),x=d[0],j=d[1],C=(0,u.useState)({}),O=C[0],T=C[1],B=(0,u.useState)(),P=B[0],M=B[1],I=(0,u.useState)(),K=I[0],N=I[1],z=(0,k.jq)(),R=z.metadata,V=z.masterEditions,_=(0,m.useUserAccounts)().accountByMint;if((0,u.useMemo)((function(){(function(){var e=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=M,e.next=3,S(r,R,V,_);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[p]),!n||!x)return(0,a.jsx)("p",{children:"Store is not defined"});var U=W(W({},Object.values(t).reduce((function(e,n){return e[n.info.address.toBase58()]=n.info,e}),{})),O),Y=[{title:"Name",dataIndex:"name",key:"name"},{title:"Address",dataIndex:"address",render:function(e){return(0,a.jsx)("span",{children:e.toBase58()})},key:"address"},{title:"Activated",dataIndex:"activated",key:"activated",render:function(e,n){return(0,a.jsx)(b.Z,{checkedChildren:"Active",unCheckedChildren:"Inactive",checked:e,onChange:function(e){return T((function(t){return W(W({},t),{},(0,o.Z)({},n.key,new v.JP({activated:e,address:n.address})))}))}})}}];return(0,a.jsxs)(A,{children:[(0,a.jsxs)(h.Z,{style:{marginTop:10},children:[(0,a.jsxs)(y.Z,{children:[(0,a.jsxs)(h.Z,{span:21,children:[(0,a.jsx)(E,{setUpdatedCreators:T,uniqueCreatorsWithUpdates:U}),(0,a.jsx)(f.Z,{onClick:(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,m.notify)({message:"Saving...",type:"info"}),e.next=3,(0,w.P)(r,c,x.public,Object.values(O));case 3:(0,m.notify)({message:"Saved",type:"success"});case 4:case"end":return e.stop()}}),e)}))),type:"primary",children:"Submit"})]}),(0,a.jsx)(h.Z,{span:3,children:(0,a.jsx)(b.Z,{checkedChildren:"Public",unCheckedChildren:"Whitelist Only",checked:x.public,onChange:function(e){j((function(t){var r=new v.yh(n.info);return r.public=e,r}))}})})]}),(0,a.jsx)(y.Z,{children:(0,a.jsx)(g.Z,{className:"artist-whitelist-table",columns:Y,dataSource:Object.keys(U).map((function(e){return{key:e,address:U[e].address,activated:U[e].activated,name:U[e].name||(0,m.shortenAddress)(U[e].address.toBase58()),image:U[e].image}}))})})]}),!n.info.public&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h1",{children:["You have ",null===P||void 0===P?void 0:P.available.length," MasterEditionV1s that can be converted right now and"," ",null===P||void 0===P?void 0:P.unavailable.length," still in unfinished auctions that cannot be converted yet."]}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(y.Z,{children:(0,a.jsx)(f.Z,{disabled:K,onClick:(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),e.next=3,Z(r,c,(null===P||void 0===P?void 0:P.available)||[],_);case 3:N(!1);case 4:case"end":return e.stop()}}),e)}))),children:K?(0,a.jsx)(l.Z,{}):(0,a.jsx)("span",{children:"Convert Eligible Master Editions"})})})})," "]})]})}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2768],{32554:function(e,t,n){"use strict";n.d(t,{W:function(){return y}});var i=n(32113),r=n(92847),a=n.n(r),o=n(76588),s=n(69819),c=n(86171),u=n(71800),l=n(83871),d=n(35551),f=n(48834).Buffer;function p(e,t,n,i,r,a,o,s,c,u,l,d,f,p){return b.apply(this,arguments)}function b(){return(b=(0,o.Z)(a().mark((function e(t,n,i,r,o,c,p,b,m,g,h,y,k,v){var x,j,w,T,B;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x=(0,s.programIds)(),j=x.store){e.next=4;break}throw new Error("Store not initialized");case 4:return w=new d.AT({winningConfigIndex:h,winningConfigItemIndex:y,creatorIndex:k}),T=f.from((0,l.serialize)(d.Yi,w)),e.t0={pubkey:t,isSigner:!1,isWritable:!0},e.t1={pubkey:n,isSigner:!1,isWritable:!0},e.t2={pubkey:i,isSigner:!1,isWritable:!0},e.next=11,(0,d.Ek)(i,h,y,k,c,g);case 11:e.t3=e.sent,e.t4={pubkey:e.t3,isSigner:!1,isWritable:!0},e.t5={pubkey:m,isSigner:!0,isWritable:!1},e.t6={pubkey:r,isSigner:!1,isWritable:!1},e.t7={pubkey:o||u.SystemProgram.programId,isSigner:!1,isWritable:!1},e.t8={pubkey:c,isSigner:!1,isWritable:!1},e.t9={pubkey:j,isSigner:!1,isWritable:!1},e.t10={pubkey:p,isSigner:!1,isWritable:!1},e.t11={pubkey:b,isSigner:!1,isWritable:!1},e.t12={pubkey:x.token,isSigner:!1,isWritable:!1},e.t13={pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1},e.t14={pubkey:u.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1},B=[e.t0,e.t1,e.t2,e.t4,e.t5,e.t6,e.t7,e.t8,e.t9,e.t10,e.t11,e.t12,e.t13,e.t14],v.push(new u.TransactionInstruction({keys:B,programId:x.metaplex,data:T}));case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=n(39975),g=n(12323),h=10;function y(e,t,n,i,r,a){return k.apply(this,arguments)}function k(){return(k=(0,o.Z)(a().mark((function e(t,n,i,r,o,c){var u,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.auction.info.ended()||i.auction.info.state===s.AuctionState.Ended){e.next=7;break}return u=[],l=[],e.next=5,(0,g.z)(t,n,o,i,c,0,l,u);case 5:return e.next=7,(0,s.sendTransactionWithRetry)(t,n,l[0],u[0]);case 7:return e.next=9,j(t,n,i,r);case 9:return e.next=11,v(t,n,i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n){return x.apply(this,arguments)}function x(){return(x=(0,o.Z)(a().mark((function e(t,n,r){var o,c,u,l,d,f,b,g,y,k,v,x,j,w,T,B,P,S,E,O,A,I,N,C;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=(0,s.programIds)(),c=[],u=[],l=[],d=[],f=[],b=[],g={},y=[].concat((0,i.Z)(r.items),(0,i.Z)(r.participationItem?[[r.participationItem]]:[])),k=0;case 10:if(!(k<y.length)){e.next=43;break}v=y[k],x=0;case 13:if(!(x<v.length)){e.next=40;break}j=v[x],w=j.metadata.info.data.creators,T=!(null===w||void 0===w||!w.map((function(e){return e.address})).find((function(e){return e.toBase58()===r.auctionManager.info.authority.toBase58()}))),B=[].concat((0,i.Z)(w?w.map((function(e){return e.address})):[]),[r.auctionManager.info.authority]),P=0;case 19:if(!(P<B.length)){e.next=37;break}return e.next=22,(0,s.findProgramAddress)([B[P].toBuffer(),o.token.toBuffer(),m.bx.toBuffer()],o.associatedToken);case 22:return E=e.sent[0],e.next=25,t.getAccountInfo(E);case 25:return O=e.sent,console.log("Existing ata?",O),O||g[E.toBase58()]||(0,s.createAssociatedTokenAccountInstruction)(b,E,n.publicKey,B[P],m.bx),g[E.toBase58()]=!0,A=w?w.map((function(e){return e.address.toBase58()})).indexOf(B[P].toBase58()):null,e.next=32,p(r.auctionManager.info.acceptPayment,E,r.auctionManager.pubkey,j.metadata.pubkey,null===(S=j.masterEdition)||void 0===S?void 0:S.pubkey,j.safetyDeposit.pubkey,j.safetyDeposit.info.vault,r.auction.pubkey,n.publicKey,B[P],j===r.participationItem?null:k,j===r.participationItem?null:x,-1===A||null===A||T&&P===B.length-1?null:A,b);case 32:b.length>=7&&(l.push(f),d.push(b),f=[],b=[]),d.length===h&&(c.push(l),u.push(d),l=[],d=[]);case 34:P++,e.next=19;break;case 37:x++,e.next=13;break;case 40:k++,e.next=10;break;case 43:b.length<7&&b.length>0&&(l.push(f),d.push(b)),d.length<=h&&d.length>0&&(c.push(l),u.push(d)),I=0;case 46:if(!(I<u.length)){e.next=59;break}if(N=u[I],C=c[I],!(N.length>=2)){e.next=54;break}return e.next=52,(0,s.sendTransactions)(t,n,N,C,s.SequenceType.StopOnFailure,"single");case 52:e.next=56;break;case 54:return e.next=56,(0,s.sendTransactionWithRetry)(t,n,N[0],C[0],"single");case 56:I++,e.next=46;break;case 59:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,n,i){return w.apply(this,arguments)}function w(){return(w=(0,o.Z)(a().mark((function e(t,n,i,r){var o,u,l,d,f,p,b,m,g,y,k;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[],u=[],l=[],d=[],f=[],p=[],b=0;case 7:if(!(b<r.length)){e.next=17;break}return m=r[b],console.log("Claiming",m.info.bidderAct.toBase58()),e.next=12,(0,c.G)(i.auctionManager.info.acceptPayment,m.info.bidderAct,m.info.bidderPot,i.vault.pubkey,i.auction.info.tokenMint,p);case 12:6===p.length&&(l.push(f),d.push(p),f=[],p=[]),d.length===h&&(o.push(l),u.push(d),l=[],d=[]);case 14:b++,e.next=7;break;case 17:p.length<6&&p.length>0&&(l.push(f),d.push(p)),d.length<=h&&d.length>0&&(o.push(l),u.push(d)),console.log("Instructions",u),g=0;case 21:if(!(g<u.length)){e.next=36;break}if(y=u[g],k=o[g],console.log("Running batch",g),!(y.length>=2)){e.next=30;break}return e.next=28,(0,s.sendTransactions)(t,n,y,k,s.SequenceType.StopOnFailure,"single");case 28:e.next=32;break;case 30:return e.next=32,(0,s.sendTransactionWithRetry)(t,n,y[0],k[0],"single");case 32:console.log("Done");case 33:g++,e.next=21;break;case 36:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},42768:function(e,t,n){"use strict";n.r(t),n.d(t,{BillingView:function(){return S},useBillingInfo:function(){return O},InnerBillingView:function(){return A}});var i=n(52322),r=n(77243),a=n(92847),o=n.n(a),s=n(76588),c=n(32113),u=n(2784),l=n(5632),d=n(37488),f=n(13721),p=n(3086),b=n(3306),m=n(24832),g=n(45556),h=n(57836),y=n(35590),k=n(69819),v=n(45719),x=n(35551),j=n(32554);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=k.contexts.Wallet.useWallet,P=d.Z.Content,S=function(){var e=(0,l.useRouter)().query.id,t=(0,h.Xk)(e),n=(0,k.useConnection)(),r=B().wallet,a=(0,k.useMint)(null===t||void 0===t?void 0:t.auction.info.tokenMint);return t&&r&&n&&a?(0,i.jsx)(A,{auctionView:t,connection:n,wallet:r,mint:a}):(0,i.jsx)(f.Z,{})};function E(e,t){var n,i,r,a=null===(n=t.auctionManager.info.settings.participationConfig)||void 0===n?void 0:n.nonWinningConstraint;return a===x.dt.GivenForFixedPrice?(null===(i=t.auctionManager.info.settings.participationConfig)||void 0===i||null===(r=i.fixedPrice)||void 0===r?void 0:r.toNumber())||0:a===x.dt.GivenForBidPrice&&e.info.lastBid.toNumber()||0}function O(e){var t,n,i=e.auctionView,r=(0,v.jq)(),a=r.bidRedemptions,l=r.bidderMetadataByAuctionAndBidder,d=i.auction.pubkey.toBase58(),f=(0,u.useState)({}),p=f[0],b=f[1],m=(0,h.hc)(i.auction.pubkey),g=function(e){var t=(0,v.jq)().payoutTickets,n=(0,u.useState)({}),i=n[0],r=n[1];return(0,u.useEffect)((function(){if(!e.items.flat().map((function(e){return e.metadata})).filter((function(e){return!e})).length){for(var n=T({},i),a=[].concat((0,c.Z)(e.items),(0,c.Z)(e.participationItem?[[e.participationItem]]:[])),o=[],s=0;s<a.length;s++)for(var u=a[s],l=0;l<u.length;l++)for(var d,f,p,b=u[l],m=(null===(d=b.metadata)||void 0===d||null===(f=d.info)||void 0===f||null===(p=f.data)||void 0===p?void 0:p.creators)||[],g=m?m.map((function(e){return e.address})).concat([e.auctionManager.info.authority]):[e.auctionManager.info.authority],h=0;h<g.length;h++){var y="".concat(e.auctionManager.pubkey.toBase58(),"-").concat(s,"-").concat(l,"-").concat(b.safetyDeposit.pubkey.toBase58(),"-").concat(g[h].toBase58(),"-").concat(h);n[y]||o.push({key:y,promise:(0,x.Ek)(e.auctionManager.pubkey,b===e.participationItem?null:s,b===e.participationItem?null:l,h<g.length-1?h:null,b.safetyDeposit.pubkey,g[h])})}Promise.all(o.map((function(e){return e.promise}))).then((function(e){e.forEach((function(e,i){t[e.toBase58()]&&(n[o[i].key]=t[e.toBase58()])})),r((function(e){return T(T({},e),n)}))}))}}),[Object.values(t).length,e.items.flat().map((function(e){return e.metadata})).filter((function(e){return!!e})).length]),Object.values(i).reduce((function(e,t){return e[t.info.recipient.toBase58()]||(e[t.info.recipient.toBase58()]={sum:0,tickets:[]}),e[t.info.recipient.toBase58()].tickets.push(t),e[t.info.recipient.toBase58()].sum+=t.info.amountPaid.toNumber(),e}),{})}(i),y=(0,c.Z)(i.auction.info.bidState.bids).reverse().slice(0,i.auctionManager.info.settings.winningConfigs.length),j=function(e){var t=(0,u.useState)({}),n=t[0],i=t[1],r=(0,k.programIds)(),a=e.auctionManager.info.settings.winningConfigs.length,l=e.auction,d=l.info.bidState.bids,f=(0,u.useMemo)((function(){return(0,c.Z)(d).reverse().slice(0,a)}),[d,a]);return(0,u.useEffect)((function(){(0,s.Z)(o().mark((function e(){var t,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.map((function(e){return(0,k.getBidderPotKey)({auctionProgramId:r.auction,auctionKey:l.pubkey,bidderPubkey:e.key}).then((function(t){return{key:t,winner:e}}))})),e.next=3,Promise.all(t);case 3:n=e.sent,a=n.reduce((function(e,t){var n=k.cache.get(t.key);return n&&(e[t.winner.key.toBase58()]=n),e}),{}),i(a);case 6:case"end":return e.stop()}}),e)})))()}),[f,i]),n}(i),w=m.filter((function(e){var t,n;return!e.info.cancelled||(null===(t=a[null===(n=p[e.pubkey.toBase58()])||void 0===n?void 0:n.toBase58()])||void 0===t?void 0:t.info.participationRedeemed)})),B=void 0!==i.auctionManager.info.settings.participationConfig&&null!==i.auctionManager.info.settings.participationConfig,P=B?w:[];(0,u.useMemo)((0,s.Z)(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=0;case 2:if(!(n<m.length)){e.next=11;break}if(r=m[n],p[r.pubkey.toBase58()]){e.next=8;break}return e.next=7,(0,x.r4)(i.auction.pubkey,r.info.bidderPubkey);case 7:t[r.pubkey.toBase58()]=e.sent.bidRedemption;case 8:n++,e.next=2;break;case 11:b(T(T({},p),t));case 12:case"end":return e.stop()}}),e)}))),[m.length]),(null===(t=i.auctionManager.info.settings.participationConfig)||void 0===t?void 0:t.winnerConstraint)===x.B1.NoParticipationPrize&&(P=P.filter((function(e){return!j[e.info.bidderPubkey.toBase58()]})));var S=null===(n=i.auctionManager.info.settings.participationConfig)||void 0===n?void 0:n.nonWinningConstraint,O=[];P.forEach((function(e){if(!j[e.info.bidderPubkey.toBase58()]&&(S===x.dt.GivenForFixedPrice||S===x.dt.GivenForBidPrice)){var t=p[e.pubkey.toBase58()];if(t){var n=a[t.toBase58()];n&&n.info.participationRedeemed||O.push(e)}else O.push(e)}}));var A=O.reduce((function(e,t){return e+E(t,i)}),0),I=P.reduce((function(e,t){var n=0;return j[t.info.bidderPubkey.toBase58()]||(n=E(t,i)),e+n}),0),N=y.reduce((function(e,t){return e+t.amount.toNumber()}),0),C=Object.values(j).filter((function(e){return!e.info.emptied}));return{bidsToClaim:(0,c.Z)(C.map((function(e){return{metadata:l["".concat(d,"-").concat(e.info.bidderAct.toBase58())],pot:e}}))),totalWinnerPayments:N,payoutTickets:g,participationEligible:P,participationPossibleTotal:I,participationUnredeemedTotal:A,hasParticipation:B}}t.default=S;var A=function(e){var t=e.auctionView,n=e.wallet,r=e.connection,a=e.mint,c=t.thumbnail.metadata.pubkey,l=(0,h.fV)(c),d=(0,h.FB)(t.auction.info.tokenMint),x=(0,u.useState)(),w=x[0],T=x[1],B=(0,v.jq)().whitelistedCreatorsByCreator,S=(0,u.useState)(0),E=S[0],A=S[1];(0,u.useEffect)((function(){r.getTokenAccountBalance(t.auctionManager.info.acceptPayment).then((function(e){void 0!==e.value.uiAmount&&null!==e.value.uiAmount&&T(e.value.uiAmount)}))}),[E]);var I=d.accounts[0],N=(0,k.useUserAccounts)().accountByMint,C=O({auctionView:t}),M=C.bidsToClaim,W=C.totalWinnerPayments,Z=C.payoutTickets,D=C.participationPossibleTotal,L=C.participationUnredeemedTotal,R=C.hasParticipation;return(0,i.jsx)(P,{children:(0,i.jsxs)(p.Z,{children:[(0,i.jsxs)(b.Z,{style:{margin:"0 30px",textAlign:"left",fontSize:"1.4rem"},children:[(0,i.jsx)(p.Z,{span:12,children:(0,i.jsx)(y.$,{pubkey:c,className:"artwork-image",allowMeshRender:!0})}),(0,i.jsxs)(p.Z,{span:12,children:[(0,i.jsx)("div",{style:{fontWeight:700},children:l.title}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{className:"info-header",children:"TOTAL AUCTION VALUE"}),(0,i.jsxs)("div",{className:"escrow",children:["\u25ce",(0,k.fromLamports)(W+D,a)]}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{className:"info-header",children:"TOTAL AUCTION REDEEMED VALUE"}),(0,i.jsxs)("div",{className:"escrow",children:["\u25ce",(0,k.fromLamports)(W+D-L,a)]}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{className:"info-header",children:"TOTAL COLLECTED BY ARTISTS AND AUCTIONEER"}),(0,i.jsxs)("div",{className:"escrow",children:["\u25ce",(0,k.fromLamports)(Object.values(Z).reduce((function(e,t){return e+t.sum}),0),a)]}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{className:"info-header",children:"TOTAL UNSETTLED"}),(0,i.jsxs)("div",{className:"escrow",children:["\u25ce",(0,k.fromLamports)(M.reduce((function(e,t){return e+t.metadata.info.lastBid.toNumber()}),0),a)]}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{className:"info-header",children:"TOTAL IN ESCROW"}),(0,i.jsx)("div",{className:"escrow",children:void 0!==w?"\u25ce".concat(w):(0,i.jsx)(f.Z,{})}),(0,i.jsx)("br",{}),R&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"info-header",children:"TOTAL UNREDEEMED PARTICIPATION FEES OUTSTANDING"}),(0,i.jsxs)("div",{className:"outstanding-open-editions",children:["\u25ce",(0,k.fromLamports)(L,a)]}),(0,i.jsx)("br",{})]}),(0,i.jsx)("br",{}),(0,i.jsx)(m.Z,{type:"primary",size:"large",className:"action-btn",onClick:(0,s.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.W)(r,n,t,M.map((function(e){return e.pot})),I.pubkey,N);case 2:A((function(e){return e+1}));case 3:case"end":return e.stop()}}),e)}))),children:"SETTLE OUTSTANDING"})]})]}),(0,i.jsx)(b.Z,{children:(0,i.jsx)(g.Z,{style:{width:"100%"},columns:[{title:"Name",dataIndex:"name",key:"name"},{title:"Address",dataIndex:"address",key:"address"},{title:"Amount Paid",dataIndex:"amountPaid",render:function(e){return(0,i.jsxs)("span",{children:["\u25ce",(0,k.fromLamports)(e,a)]})},key:"amountPaid"}],dataSource:Object.keys(Z).map((function(e){var t,n;return{key:e,name:(null===(t=B[e])||void 0===t||null===(n=t.info)||void 0===n?void 0:n.name)||"N/A",address:e,amountPaid:Z[e].sum}}))})})]})})}}}]);